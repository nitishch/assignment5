#!/bin/bash
bc <<< "scale=$5"
j=1
file=../data/g28_lab05data_02.csv
touch ../data/average.csv
while [ $j -le 6 ]
do
	steptime=0
	colltime=0
	veltime=0
	postime=0
	looptime=0
	rerun=1
	while [ $rerun -le 150 ]
	do
		line=$(((${j}-1)*150+${rerun}))
#		echo $line
		stepadder=$(echo -n $(sed -n "${line}s/^[^,]*,[^,]*,\([^,]*\),.*$/\1/p" ${file}) )
#		stepadder=$(echo -n $(sed -n "$(( ($j-1)*150+${rerun} ))s/^[^,]*,[^,]*,\([^,]*\),.*$/\1/p" ${file}) )
		colladder=$(echo -n $(sed -n "${line}s/^[^,]*,[^,]*,[^,]*,\([^,]*\),.*$/\1/p" ${file}) )
		veladder=$(echo -n $(sed -n "${line}s/^[^,]*,[^,]*,[^,]*,[^,]*,\([^,]*\),.*$/\1/p" ${file}) )
		posadder=$(echo -n $(sed -n "${line}s/^[^,]*,[^,]*,[^,]*,[^,]*,[^,]*,\([^,]*\),.*$/\1/p" ${file}) )
		loopadder=$(echo -n $(sed -n "${line}s/^[^,]*,[^,]*,[^,]*,[^,]*,[^,]*,[^,]*,\([^,]*\).*$/\1/p" ${file}) )
	if [ $(echo "$colladder < 300" | bc) -eq 1 ]
	then		
		colltime=$(echo "${colltime}+${colladder}" | bc)
	fi	
	if [ $(echo "$veladder < 300" | bc) -eq 1 ]
	then		
		veltime=$(echo "${veltime}+${veladder}" | bc)
	fi	
	if [ $(echo "$posadder < 300" | bc) -eq 1 ]
	then		
		postime=$(echo "${postime}+${posadder}" | bc)
	fi	
	if [ $(echo "$loopadder < 300" | bc) -eq 1 ]
	then		
		looptime=$(echo "${looptime}+${loopadder}" | bc)
	fi	
	if [ $(echo "$stepadder < 300" | bc) -eq 1 ]
	then
		steptime=$(echo "${steptime}+${stepadder}" | bc)
	fi
#		echo ";aiwo"
		rerun=$((${rerun}+1))
	done
	
#	(( steptime = $(echo "$steptime > 300" | bc)?$(echo "$steptime/150" | bc):$steptime ))
#	if [ $(echo "$steptime < 300" | bc) ]
#	then
	steptime=$(echo "$steptime/150" | bc)
#	fi
#	echo $steptime		
	colltime=$(echo "$colltime/150" | bc)
	veltime=$(echo "$veltime/150" | bc)
	postime=$(echo "$postime/150" | bc)
	looptime=$(echo "$looptime/150" | bc)
	echo "$j,$steptime,$colltime,$veltime,$postime,$looptime" >> ../data/average.csv
	j=$(($j+1))
done
